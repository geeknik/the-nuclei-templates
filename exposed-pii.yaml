id: exposed-pii

info:
  name: Exposed PII
  author: geeknik
  severity: info
  description: Detects potential PII exposure including SSNs and credit card numbers in HTTP responses.
  tags: pii,exposure,sensitive

requests:
  - method: GET
    path:
      - "{{BaseURL}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: header
        words:
          - "text/html"
          - "text/plain"
          - "application/json"
        condition: or

      # Must match at least one PII pattern
      - type: regex
        condition: or
        regex:
          # SSN: require word boundaries to avoid matching dates/phone fragments
          - "\\b(?!000|666|9\\d{2})\\d{3}-(?!00)\\d{2}-(?!0000)\\d{4}\\b"
          # Visa: formatted with separators (word-boundary safe)
          - "\\b4\\d{3}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"
          # Mastercard: formatted with separators
          - "\\b5[1-5]\\d{2}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"
          # Amex: formatted with separators
          - "\\b3[47]\\d{2}[\\s\\-\\.]\\d{6}[\\s\\-\\.]\\d{5}\\b"
          # Discover: formatted with separators
          - "\\b6011[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"

      # Negative: exclude well-known test/example values
      - type: word
        words:
          - "123-45-6789"
          - "000-00-0000"
          - "111-11-1111"
          - "4111 1111 1111 1111"
          - "4111-1111-1111-1111"
          - "5500 0000 0000 0004"
          - "378282246310005"
          - "example"
          - "sample"
          - "test"
          - "fake"
          - "dummy"
        part: body
        condition: or
        negative: true

    extractors:
      - type: regex
        name: SSN
        regex:
          - "\\b(?!000|666|9\\d{2})\\d{3}-(?!00)\\d{2}-(?!0000)\\d{4}\\b"

      - type: regex
        name: Visa
        regex:
          - "\\b4\\d{3}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"

      - type: regex
        name: Mastercard
        regex:
          - "\\b5[1-5]\\d{2}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"

      - type: regex
        name: Amex
        regex:
          - "\\b3[47]\\d{2}[\\s\\-\\.]\\d{6}[\\s\\-\\.]\\d{5}\\b"

      - type: regex
        name: Discover
        regex:
          - "\\b6011[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}[\\s\\-\\.]\\d{4}\\b"
